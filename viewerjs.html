<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="jquery.js" type="text/javascript"></script>
<script type="text/javascript">
var flag=0;
var locA;
var locB;
function abc()
{
//Get access to canvas element on which PDF file gets rendered.
//Generally the canvas Element has id  "canvas1" (say for 1st page).
	
var can=document.getElementById('frame').contentWindow.document.getElementById("canvas1");

	var ctx= can.getContext('2d');
	
	

//Code to draw rectangle instead of line on canvas.	
	//ctx.rect(0, 50, 50, 100);
	//ctx.fillStyle = 'yellow';
    //ctx.fill();
    //ctx.lineWidth = 7;
    //ctx.strokeStyle = 'black';
    //ctx.stroke();
	

//Code to draw line on canvas.
	ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo(300,150);
    ctx.stroke();
	
	
//Following CODE is to add annotate button on toolbar
//we use insertBefore() function to add the button.
//Add button on DIV element with ID "toolbarRight".
   	if(flag == 0)
	{
    elem = document.createElement("BUTTON");

	elem.id = 'butt';
    elem.innerHTML = ' annotate ';
	elem.addEventListener("click",annotate,false);
	var qwe=document.getElementById('frame').contentWindow.document.getElementById("toolbarRight");
    qwe.insertBefore(elem,qwe.childNodes[0]);
	flag=1;
	
	}
	function annotate()
   { 
   //CODE to draw annotations on the canvas.
   //This code will erase the content canvas that we are drawing upon and redraws rectangle according to mouse drag.
   //Should be able draw a rectangle without erasing canvas first.
   //Rectangle drawn using mouse drag is not exactly where mouse is pointed. Need to fix it 
 
   	var iBody = $("#frame").contents().find("body");

    //obtain control over any element in iframe(#canvas1)
    var myContent = iBody.find("#canvas1");
   
  

	
	
	
	
	ctx.strokeStyle = "blue";
    ctx.lineWidth=3;

    // calculate where the canvas is on the window
    // (used to help calculate mouseX/mouseY)
    var $canvas=iBody;
    var canvasOffset=$canvas.offset();
    var offsetX=canvasOffset.left;
    var offsetY=canvasOffset.top;
    var scrollX=$canvas.scrollLeft();
    var scrollY=$canvas.scrollTop();

    // this flage is true when the user is dragging the mouse
    var isDown=false;

    // these vars will hold the starting mouse position
    var startX;
    var startY;


    function handleMouseDown(e){
      e.preventDefault();
      e.stopPropagation();

      // save the starting x/y of the rectangle
      startX=parseInt(e.clientX-offsetX);
      startY=parseInt(e.clientY-offsetY);

      // set a flag indicating the drag has begun
      isDown=true;
    }

    function handleMouseUp(e){
      e.preventDefault();
      e.stopPropagation();

      // the drag is over, clear the dragging flag
      isDown=false;
    }

    function handleMouseOut(e){
      e.preventDefault();
      e.stopPropagation();

      // the drag is over, clear the dragging flag
      isDown=false;
    }

    function handleMouseMove(e){
      e.preventDefault();
      e.stopPropagation();

      // if we're not dragging, just return
      if(!isDown){return;}

      // get the current mouse position
      mouseX=parseInt(e.clientX-offsetX);
      mouseY=parseInt(e.clientY-offsetY);

      // Put your mousemove stuff here

      // clear the canvas
      ctx.clearRect(0,0,can.width,can.height);

      // calculate the rectangle width/height based
      // on starting vs current mouse position
      var width=mouseX-startX;
      var height=mouseY-startY;

      // draw a new rect from the start position 
      // to the current mouse position
      ctx.strokeRect(startX,startY,width,height);

    }

    // listen for mouse events
   iBody.mousedown(function(e){handleMouseDown(e);});
   iBody.mousemove(function(e){handleMouseMove(e);});
    iBody.mouseup(function(e){handleMouseUp(e);});
   iBody.mouseout(function(e){handleMouseOut(e);});

	
   }




}


</script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Untitled Document</title>
</head>

<body>
<button onclick="abc();">Enable Annotations</button>
<a href="ViewerJs/#../ViewerJs/C.pdf">qwe</a>
<iframe id="frame" src ="ViewerJs/#../ViewerJs/C.pdf" width='800' height='600'></iframe>
</body>
</html>
